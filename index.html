<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Ch√° de Casa Nova v2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f4f4f4;margin:0}
header{background:#6c5ce7;color:white;padding:20px;text-align:center}
.container{padding:20px;max-width:900px;margin:auto}
.item{background:white;padding:15px;border-radius:8px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
.item a{background:#6c5ce7;color:white;padding:8px 12px;border-radius:6px;text-decoration:none}
.item a:hover{opacity:.8}
footer{text-align:center;color:#777;padding:20px}
</style>
</head>
<body>
<header>
<h1>Ch√° de Casa Nova</h1>
<p>Escolha um presente e nos ajude a montar nosso lar üíú</p>
</header>
<div class="container">

  <div id="loading" style="
  text-align:center;
  padding:20px;
  font-size:18px;
  color:#6c5ce7;
  font-weight:bold;
">
  üîÑ Carregando lista de presentes...
</div>


<div class="item"><span>Jogo de Pratos</span><button onclick="marcar(this)">Vou comprar</button><a href="https://shopee.com.br" target="_blank">Comprar</a></div>
<div class="item"><span>Conjunto de Copos</span><button onclick="marcar(this)">Vou comprar</button><a href="https://shopee.com.br" target="_blank">Comprar</a></div>
<div class="item"><span>Jogo de Talheres</span><button onclick="marcar(this)">Vou comprar</button><a href="https://shopee.com.br" target="_blank">Comprar</a></div>
<div class="item"><span>Jogo de Panelas</span><button onclick="marcar(this)">Vou comprar</button><a href="https://shopee.com.br" target="_blank">Comprar</a></div>
<div class="item"><span>Liquidificador</span><button onclick="marcar(this)">Vou comprar</button><a href="https://shopee.com.br" target="_blank">Comprar</a></div>
<div class="item"><span>Sanduicheira</span><button onclick="marcar(this)">Vou comprar</button><a href="https://shopee.com.br" target="_blank">Comprar</a></div>
<div class="item"><span>Ferro de Passar</span><button onclick="marcar(this)">Vou comprar</button><a href="https://shopee.com.br" target="_blank">Comprar</a></div>
</div>
<footer>
<p>Com carinho ‚ù§Ô∏è</p>
</footer>
<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbz_5lK57_Sg9m_4LJHr-BHoTOggAprk6Ai54xLugWzYe0vXFHy7R1kLEabRuIR85ErDhQ/exec';

let primeiraCarga = true;

async function carregar(){

  // loading APENAS ao entrar no site
  if(primeiraCarga){
    document.getElementById('loading').style.display = 'block';

    document.querySelectorAll('.item button').forEach(b=>{
      b.disabled = true;
      b.innerText = 'Carregando...';
    });
  }

  try{
    const r = await fetch(API_URL + '?t=' + Date.now());
    const dados = await r.json();

    document.querySelectorAll('.item').forEach((div,i)=>{
      const status = dados[i+1][1];
      const nome = dados[i+1][2];
      const btn = div.querySelector('button');

      if(status === 'Comprado'){
        btn.innerText = 'COMPRADO';
        btn.style.background = '#00b894';
        btn.disabled = true;
      }else{
        btn.innerText = 'Vou comprar';
        btn.style.background = '#6c5ce7';
        btn.disabled = false;
      }

      btn.onclick = ()=>comprar(i+2, btn);
    });

  }catch(e){
    if(primeiraCarga){
      document.getElementById('loading').innerText =
        '‚ùå Erro ao carregar dados. Atualize a p√°gina.';
    }
    console.error(e);
  }

  // some com loading depois da primeira resposta
  if(primeiraCarga){
    document.getElementById('loading').style.display = 'none';
    primeiraCarga = false;
  }
}

async function comprar(linha,btn){
  const nome = prompt('Seu nome:');
  if(!nome) return;

  btn.innerText = 'Salvando...';
  btn.disabled = true;

  await fetch(API_URL,{
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body:`linha=${linha}&nome=${encodeURIComponent(nome)}`
  });

  carregar();
}

// primeira carga imediata
carregar();

// atualiza√ß√µes silenciosas
setInterval(carregar, 2000);
</script>


</body>
</html>
